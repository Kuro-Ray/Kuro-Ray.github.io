<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Учебник</title>
    <link rel="shortcut icon" href="../img/Facebook-публикация 940x788  пикс.png" type="image/x-icon">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=La+Belle+Aurore&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" media="screen,projection" href="../css/ui.totop.css" />
</head>
<body>
    
    <nav class="navbar navbar-dark">

        <a class="navbar-brand" href="#"><img src="../img/Facebook-публикация 940x788  пикс.png"></a>
        
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" id="home" href="../index.html">
                <i class="fas fa-home " id="icon-home"></i>
                <span class="icon-text-home">Главная</span>
            </a>
          </li>          
          <li class="nav-item">
            <a class="nav-link" id="works" href="../works.html">
                <i class="fas fa-eye" id="icon-works"></i>
                <span class="icon-text-works">Содержание</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="about" href="#">
                <i class="fa fa-leanpub active" id="icon-about"></i>
                <span class="icon-text-about">Учебник</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="test" href="../test.html">
                <i class="fa fa-sticky-note-o" id="icon-test"></i>
                <span class="icon-text-test">Тест</span>
            </a>
          </li>
        </ul>

        <ul class="soc">
            <li style="list-style-type: none;"><a href="https://vk.com/kuromaro" target="_blank" title="VKontakte"><i class="fa fa-vk"></i></a></li>
            <li style="list-style-type: none;"><a href="https://www.instagram.com/erdneev_ray/" target="_blank" title="Instagram"><i class="fa fa-instagram"></i></a></li>
        </ul>
    </nav>

    <main>

        <section id="about">
            <div class="articleText" id="articleText">
                <h1>Подзапросы</h1><h2>Выполнение подзапросов</h2>
                
                <div style="margin-top:23px;margin-left:6px;"><div></div>
                <style>
                .footer-adaptive { width: 320px; height: 100px; }
                @media(min-width: 480px) { .footer-adaptive { width: 468px; height: 60px; } }
                @media(min-width: 760px) { .footer-adaptive { width: 728px; height: 90px;  } }
                @media(min-width: 1000px) { .footer-adaptive { width: 468px; height: 60px;  } }
                @media(min-width: 1122px) { .footer-adaptive{ width: 728px; height: 90px;} }
                @media(min-width: 1400px) { .footer-adaptive { width: 970px; height: 90px;} }
                </style>
                <!-- footer_adaptive -->
                <ins class="adsbygoogle footer-adaptive" style="display:inline-block" data-ad-client="ca-pub-3716042175333627" data-ad-slot="9659512088"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                
                </div>

                <div class="navs">
                  <h1 id="about-me">
                    <a href="../5/5.2.html">Назад</a>
                    <a href="../4/4.2.html" class="page_num" pagenum="17">17</a>
                    <a href="../4/4.3.html" class="page_num" pagenum="18">18</a>
                    <a href="../4/4.4.html" class="page_num" pagenum="19">19</a>
                    <a href="../4/4.5.html" class="page_num" pagenum="20">20</a>
                    <a href="../4/4.6.html" class="page_num" pagenum="21">21</a>
                    <a href="../4/4.7.html" class="page_num" pagenum="22">22</a>
                    <a href="../5/5.html" class="page_num" pagenum="23">23</a>
                    <a href="../5/5.1.html" class="page_num" pagenum="24">24</a>
                    <a href="../5/5.2.html" class="page_num" pagenum="25">25</a>
                    <a href="../6/6.html" class="page_num selected" pagenum="26">26</a>
                    <a href="../6/6.1.html" class="page_num" pagenum="27">27</a>
                    <a href="../6/6.2.html" class="page_num" pagenum="28">28</a>
                    <a href="../7/7.html" class="page_num" pagenum="29">29</a>
                    <a href="../7/7.1.html" class="page_num" pagenum="30">30</a>
                    <a href="../7/7.2.html" class="page_num" pagenum="31">31</a>
                    <a href="../7/7.3.html" class="page_num" pagenum="32">32</a>
                    <a href="../7/7.4.html" class="page_num" pagenum="33">33</a>
                    <a href="../7/7.5.html" class="page_num" pagenum="34">34</a>
                    <a href="6.1.html">Вперед</a>
                  </h1>
                </div><br><br>
                
                <p>T-SQL поддерживает функциональность подзапросов (subquery), то есть таких запросов, которые могут встроены в другие запросы.</p>
                <p>Например, создадим таблицы для товаров, покупателей и заказов:</p>
                <div><div id="highlighter_836841" class="syntaxhighlighter  sql"><div class="toolbar"><span></span></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="sql plain">USE productsdb;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">Products</code></div><div class="line number4 index3 alt1"><code class="sql plain">(</code></div><div class="line number5 index4 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">Id </code><code class="sql keyword">INT</code> <code class="sql plain">IDENTITY </code><code class="sql keyword">PRIMARY</code> <code class="sql keyword">KEY</code><code class="sql plain">,</code></div><div class="line number6 index5 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">ProductName NVARCHAR(30) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number7 index6 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">Manufacturer NVARCHAR(20) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number8 index7 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">ProductCount </code><code class="sql keyword">INT</code> <code class="sql keyword">DEFAULT</code> <code class="sql plain">0,</code></div><div class="line number9 index8 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">Price MONEY </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code></div><div class="line number10 index9 alt1"><code class="sql plain">);</code></div><div class="line number11 index10 alt2"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">Customers</code></div><div class="line number12 index11 alt1"><code class="sql plain">(</code></div><div class="line number13 index12 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">Id </code><code class="sql keyword">INT</code> <code class="sql plain">IDENTITY </code><code class="sql keyword">PRIMARY</code> <code class="sql keyword">KEY</code><code class="sql plain">,</code></div><div class="line number14 index13 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">FirstName NVARCHAR(30) </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code></div><div class="line number15 index14 alt2"><code class="sql plain">);</code></div><div class="line number16 index15 alt1"><code class="sql keyword">CREATE</code> <code class="sql keyword">TABLE</code> <code class="sql plain">Orders</code></div><div class="line number17 index16 alt2"><code class="sql plain">(</code></div><div class="line number18 index17 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">Id </code><code class="sql keyword">INT</code> <code class="sql plain">IDENTITY </code><code class="sql keyword">PRIMARY</code> <code class="sql keyword">KEY</code><code class="sql plain">,</code></div><div class="line number19 index18 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">ProductId </code><code class="sql keyword">INT</code> <code class="sql color1">NOT</code> <code class="sql color1">NULL</code> <code class="sql keyword">REFERENCES</code> <code class="sql plain">Products(Id) </code><code class="sql keyword">ON</code> <code class="sql keyword">DELETE</code> <code class="sql keyword">CASCADE</code><code class="sql plain">,</code></div><div class="line number20 index19 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">CustomerId </code><code class="sql keyword">INT</code> <code class="sql color1">NOT</code> <code class="sql color1">NULL</code> <code class="sql keyword">REFERENCES</code> <code class="sql plain">Customers(Id) </code><code class="sql keyword">ON</code> <code class="sql keyword">DELETE</code> <code class="sql keyword">CASCADE</code><code class="sql plain">,</code></div><div class="line number21 index20 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">CreatedAt </code><code class="sql keyword">DATE</code> <code class="sql color1">NOT</code> <code class="sql color1">NULL</code><code class="sql plain">,</code></div><div class="line number22 index21 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">ProductCount </code><code class="sql keyword">INT</code> <code class="sql keyword">DEFAULT</code> <code class="sql plain">1,</code></div><div class="line number23 index22 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">Price MONEY </code><code class="sql color1">NOT</code> <code class="sql color1">NULL</code></div><div class="line number24 index23 alt1"><code class="sql plain">);</code></div></div></td></tr></tbody></table></div></div>
                <p>Таблица Orders содержит ссылки на две другие таблицы через поля ProductId и CustomerId.</p>
                <p>Добавим в таблицы некоторые данные:</p>
                <div><div id="highlighter_572541" class="syntaxhighlighter  sql"><div class="toolbar"><span></span></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="sql keyword">INSERT</code> <code class="sql keyword">INTO</code> <code class="sql plain">Products </code></div><div class="line number2 index1 alt1"><code class="sql keyword">VALUES</code> <code class="sql plain">(</code><code class="sql string">'iPhone 6'</code><code class="sql plain">, </code><code class="sql string">'Apple'</code><code class="sql plain">, 2, 36000),</code></div><div class="line number3 index2 alt2"><code class="sql plain">(</code><code class="sql string">'iPhone 6S'</code><code class="sql plain">, </code><code class="sql string">'Apple'</code><code class="sql plain">, 2, 41000),</code></div><div class="line number4 index3 alt1"><code class="sql plain">(</code><code class="sql string">'iPhone 7'</code><code class="sql plain">, </code><code class="sql string">'Apple'</code><code class="sql plain">, 5, 52000),</code></div><div class="line number5 index4 alt2"><code class="sql plain">(</code><code class="sql string">'Galaxy S8'</code><code class="sql plain">, </code><code class="sql string">'Samsung'</code><code class="sql plain">, 2, 46000),</code></div><div class="line number6 index5 alt1"><code class="sql plain">(</code><code class="sql string">'Galaxy S8 Plus'</code><code class="sql plain">, </code><code class="sql string">'Samsung'</code><code class="sql plain">, 1, 56000),</code></div><div class="line number7 index6 alt2"><code class="sql plain">(</code><code class="sql string">'Mi 5X'</code><code class="sql plain">, </code><code class="sql string">'Xiaomi'</code><code class="sql plain">, 2, 26000),</code></div><div class="line number8 index7 alt1"><code class="sql plain">(</code><code class="sql string">'OnePlus 5'</code><code class="sql plain">, </code><code class="sql string">'OnePlus'</code><code class="sql plain">, 6, 38000)</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="sql keyword">INSERT</code> <code class="sql keyword">INTO</code> <code class="sql plain">Customers </code><code class="sql keyword">VALUES</code> <code class="sql plain">(</code><code class="sql string">'Tom'</code><code class="sql plain">), (</code><code class="sql string">'Bob'</code><code class="sql plain">),(</code><code class="sql string">'Sam'</code><code class="sql plain">)</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="sql keyword">INSERT</code> <code class="sql keyword">INTO</code> <code class="sql plain">Orders </code></div><div class="line number13 index12 alt2"><code class="sql keyword">VALUES</code></div><div class="line number14 index13 alt1"><code class="sql plain">( </code></div><div class="line number15 index14 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">Id </code><code class="sql keyword">FROM</code> <code class="sql plain">Products </code><code class="sql keyword">WHERE</code> <code class="sql plain">ProductName=</code><code class="sql string">'Galaxy S8'</code><code class="sql plain">), </code></div><div class="line number16 index15 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">Id </code><code class="sql keyword">FROM</code> <code class="sql plain">Customers </code><code class="sql keyword">WHERE</code> <code class="sql plain">FirstName=</code><code class="sql string">'Tom'</code><code class="sql plain">),</code></div><div class="line number17 index16 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql string">'2017-07-11'</code><code class="sql plain">,&nbsp; </code></div><div class="line number18 index17 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">2, </code></div><div class="line number19 index18 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">Price </code><code class="sql keyword">FROM</code> <code class="sql plain">Products </code><code class="sql keyword">WHERE</code> <code class="sql plain">ProductName=</code><code class="sql string">'Galaxy S8'</code><code class="sql plain">)</code></div><div class="line number20 index19 alt1"><code class="sql plain">),</code></div><div class="line number21 index20 alt2"><code class="sql plain">( </code></div><div class="line number22 index21 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">Id </code><code class="sql keyword">FROM</code> <code class="sql plain">Products </code><code class="sql keyword">WHERE</code> <code class="sql plain">ProductName=</code><code class="sql string">'iPhone 6S'</code><code class="sql plain">), </code></div><div class="line number23 index22 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">Id </code><code class="sql keyword">FROM</code> <code class="sql plain">Customers </code><code class="sql keyword">WHERE</code> <code class="sql plain">FirstName=</code><code class="sql string">'Tom'</code><code class="sql plain">),</code></div><div class="line number24 index23 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql string">'2017-07-13'</code><code class="sql plain">,&nbsp; </code></div><div class="line number25 index24 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">1, </code></div><div class="line number26 index25 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">Price </code><code class="sql keyword">FROM</code> <code class="sql plain">Products </code><code class="sql keyword">WHERE</code> <code class="sql plain">ProductName=</code><code class="sql string">'iPhone 6S'</code><code class="sql plain">)</code></div><div class="line number27 index26 alt2"><code class="sql plain">),</code></div><div class="line number28 index27 alt1"><code class="sql plain">( </code></div><div class="line number29 index28 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">Id </code><code class="sql keyword">FROM</code> <code class="sql plain">Products </code><code class="sql keyword">WHERE</code> <code class="sql plain">ProductName=</code><code class="sql string">'iPhone 6S'</code><code class="sql plain">), </code></div><div class="line number30 index29 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">Id </code><code class="sql keyword">FROM</code> <code class="sql plain">Customers </code><code class="sql keyword">WHERE</code> <code class="sql plain">FirstName=</code><code class="sql string">'Bob'</code><code class="sql plain">),</code></div><div class="line number31 index30 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql string">'2017-07-11'</code><code class="sql plain">,&nbsp; </code></div><div class="line number32 index31 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">1, </code></div><div class="line number33 index32 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">Price </code><code class="sql keyword">FROM</code> <code class="sql plain">Products </code><code class="sql keyword">WHERE</code> <code class="sql plain">ProductName=</code><code class="sql string">'iPhone 6S'</code><code class="sql plain">)</code></div><div class="line number34 index33 alt1"><code class="sql plain">)</code></div></div></td></tr></tbody></table></div></div>
                <p>Здесь интерес представляет добавление элементов в таблицу Orders. Например, первый заказ был сделан покупателем Tom на товар Galaxy S8. Соответственно 
                в таблицу Orders нам надо сохранить информацию о заказе, где поле ProductId указывает на Id товара Galaxy S8, поле Price - на его цену, а поле 
                CustomerId - на Id покупателя Tom. Но на момент написания запроса нам может быть неизвестен ни Id покупателя, ни Id товара, ни цена товара. В этом случае можно выполнить подзапрос.</p>
                <p>Подзапрос выполняет команду SELECT и заключается в скобки. В данном же случае при добавлении одного товара выполняется три подзапроса. Каждый подзапрос возвращает одного скалярное значение, например, числовой идентификатор.</p>
                <p>В данном случае подзапросы выполнялись к другой таблице, но могут выполняться и к той же, к которой вызывается основной запрос. Например, найдем 
                товары из таблицы Products, которые имеют минимальную цену:</p>
                <div><div id="highlighter_721889" class="syntaxhighlighter  sql"><div class="toolbar"><span></span></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="sql keyword">SELECT</code> <code class="sql plain">*</code></div><div class="line number2 index1 alt1"><code class="sql keyword">FROM</code> <code class="sql plain">Products</code></div><div class="line number3 index2 alt2"><code class="sql keyword">WHERE</code> <code class="sql plain">Price = (</code><code class="sql keyword">SELECT</code> <code class="sql keyword">MIN</code><code class="sql plain">(Price) </code><code class="sql keyword">FROM</code> <code class="sql plain">Products)</code></div></div></td></tr></tbody></table></div></div>
                <p>Или найдем товары, цена которых выше средней:</p>
                <div><div id="highlighter_316472" class="syntaxhighlighter  sql"><div class="toolbar"><span></span></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="sql keyword">SELECT</code> <code class="sql plain">*</code></div><div class="line number2 index1 alt1"><code class="sql keyword">FROM</code> <code class="sql plain">Products</code></div><div class="line number3 index2 alt2"><code class="sql keyword">WHERE</code> <code class="sql plain">Price &gt; (</code><code class="sql keyword">SELECT</code> <code class="sql color2">AVG</code><code class="sql plain">(Price) </code><code class="sql keyword">FROM</code> <code class="sql plain">Products)</code></div></div></td></tr></tbody></table></div></div>
                <p class="fig"><img src="../img/100.png" alt="Подзапросы в T-SQL и MS SQL Server"></p>
                <h3>Коррелирующие подзапросы</h3>
                <p>Подзапросы бывают коррелирующими и некоррелирующими. В примерах выше команды SELECT выполняли фактически один подзапрос для всей команды, например, подзапрос возвращает 
                минимальную или среднюю цену, которая не изменится, сколько бы мы строк не выбирали в основном запросе. 
                То есть результат подзапроса не зависел от строк, которые выбираются в основном запросе. И такой подзапрос выполняется один раз для всего 
                внешнего запроса.</p>
                <p>Но также существуют <span class="b">коррелирующие подзапросы</span> (correlated subquery), результаты которых зависят от строк, 
                которые выбираются в основном запросе.</p>
                <p>Например, выберем все заказы из таблицы Orders, добавив к ним информацию о товаре:</p>
                <div><div id="highlighter_188598" class="syntaxhighlighter  sql"><div class="toolbar"><span></span></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="sql keyword">SELECT</code>&nbsp; <code class="sql plain">CreatedAt, </code></div><div class="line number2 index1 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">Price, </code></div><div class="line number3 index2 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql plain">ProductName </code><code class="sql keyword">FROM</code> <code class="sql plain">Products </code></div><div class="line number4 index3 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql keyword">WHERE</code> <code class="sql plain">Products.Id = Orders.ProductId) </code><code class="sql keyword">AS</code> <code class="sql plain">Product</code></div><div class="line number5 index4 alt2"><code class="sql keyword">FROM</code> <code class="sql plain">Orders</code></div></div></td></tr></tbody></table></div></div>
                <p>Здесь для каждой строки из таблицы Orders будет выполняться подзапрос, результат которого зависит от столбца ProductId. И каждый подзапрос может возвращать различные данные.</p>
                <p class="fig"><img src="../img/101.png" alt="Correlated subquery in T-SQL"></p>
                <p>Коррелирующий подзапрос может выполняться и для той же таблицы, к которой выполняется основной запрос. 
                Например, выберем из таблицы Products те товары, стоимость которых выше средней цены товаров для данного производителя:</p>
                <div><div id="highlighter_737596" class="syntaxhighlighter  sql"><div class="toolbar"><span></span></div><table cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="sql keyword">SELECT</code> <code class="sql plain">ProductName,</code></div><div class="line number2 index1 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">Manufacturer,</code></div><div class="line number3 index2 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">Price, </code></div><div class="line number4 index3 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql color2">AVG</code><code class="sql plain">(Price) </code><code class="sql keyword">FROM</code> <code class="sql plain">Products </code><code class="sql keyword">AS</code> <code class="sql plain">SubProds </code></div><div class="line number5 index4 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql keyword">WHERE</code> <code class="sql plain">SubProds.Manufacturer=Prods.Manufacturer)&nbsp; </code><code class="sql keyword">AS</code> <code class="sql plain">AvgPrice</code></div><div class="line number6 index5 alt1"><code class="sql keyword">FROM</code> <code class="sql plain">Products </code><code class="sql keyword">AS</code> <code class="sql plain">Prods</code></div><div class="line number7 index6 alt2"><code class="sql keyword">WHERE</code> <code class="sql plain">Price &gt; </code></div><div class="line number8 index7 alt1"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql plain">(</code><code class="sql keyword">SELECT</code> <code class="sql color2">AVG</code><code class="sql plain">(Price) </code><code class="sql keyword">FROM</code> <code class="sql plain">Products </code><code class="sql keyword">AS</code> <code class="sql plain">SubProds </code></div><div class="line number9 index8 alt2"><code class="sql spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="sql keyword">WHERE</code> <code class="sql plain">SubProds.Manufacturer=Prods.Manufacturer)</code></div></div></td></tr></tbody></table></div></div>
                <p class="fig"><img src="../img/97.png" alt="Коррелирующий подзапрос в T-SQL"></p>
                <p>В данном случае определено два коррелирующих подзапроса. Первый подзапрос определяет спецификацию столбца AvgPrice. 
                Он будет выполняться для каждой строки, извлекаемой из таблицы Products. В подзапрос передается производитель товара и на его основе выбирается 
                средняя цена для товаров именно этого производителя. И так как производитель у товаров может отличаться, то и результат подзапроса в каждом случае также может отличаться.</p>
                <p>Второй подзапрос аналогичен, только он используется для фильтрации извлекаемых из таблицы Products. И также он будет выполняться для каждой строки.</p>
                <p>Чтобы избежать двойственности при фильтрации в подзапросе при сравнении производителей (<code>SubProds.Manufacturer=Prods.Manufacturer</code>) для внешней выборки установлен псевдоним Prods, а для выборки из подзапросов определен псевдоним 
                SubProds.</p>
                <p>Следует учитывать, что коррелирующие подзапросы выполняются для каждой отдельной строки выборки, то выполнение таких подзапросов может замедлять выполнение всего запроса в целом.</p>
                <div style="margin-top:25px;clear:both;">
                <style>
                .metanit-rect { width: 300px; height: 250px; }
                @media(min-width: 500px) { .metanit-rect { width: 336px; height: 280px; } }
                @media(min-width: 760px) { .metanit-rect { width: 728px; height: 90px;  } }
                @media(min-width: 1000px) { .metanit-rect { width: 336px; height: 280px;  } }
                @media(min-width: 1122px) { .metanit-rect{ width: 728px; height: 90px;} }
                @media(min-width: 1400px) { .metanit-rect{ width: 970px; height: 90px;} }
                </style>
                <!-- metanit_rect -->
                <ins class="adsbygoogle metanit-rect" style="display:inline-block" data-ad-client="ca-pub-3716042175333627" data-ad-slot="3119477283"></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                </div>
                               
                
                
                  <div class="navs">
                    <h1 id="about-me">
                      <a href="../5/5.2.html">Назад</a>
                      <a href="../4/4.2.html" class="page_num" pagenum="17">17</a>
                      <a href="../4/4.3.html" class="page_num" pagenum="18">18</a>
                      <a href="../4/4.4.html" class="page_num" pagenum="19">19</a>
                      <a href="../4/4.5.html" class="page_num" pagenum="20">20</a>
                      <a href="../4/4.6.html" class="page_num" pagenum="21">21</a>
                      <a href="../4/4.7.html" class="page_num" pagenum="22">22</a>
                      <a href="../5/5.html" class="page_num" pagenum="23">23</a>
                      <a href="../5/5.1.html" class="page_num" pagenum="24">24</a>
                      <a href="../5/5.2.html" class="page_num" pagenum="25">25</a>
                      <a href="../6/6.html" class="page_num selected" pagenum="26">26</a>
                      <a href="../6/6.1.html" class="page_num" pagenum="27">27</a>
                      <a href="../6/6.2.html" class="page_num" pagenum="28">28</a>
                      <a href="../7/7.html" class="page_num" pagenum="29">29</a>
                      <a href="../7/7.1.html" class="page_num" pagenum="30">30</a>
                      <a href="../7/7.2.html" class="page_num" pagenum="31">31</a>
                      <a href="../7/7.3.html" class="page_num" pagenum="32">32</a>
                      <a href="../7/7.4.html" class="page_num" pagenum="33">33</a>
                      <a href="../7/7.5.html" class="page_num" pagenum="34">34</a>
                      <a href="6.1.html">Вперед</a>
                    </h1>
                  </div>
        </section>

    </main>

    <div class="container-footer">
      <div class="footer">
           <div class="copyright">
               © 2021 Все права защищены | <a href="https://vk.com/kuromaro">АВТОР</a>
           </div>

           <div class="information">
               <a href="../index.html">Главная</a> | <a href="../works.html">Содержание</a> | <a href="../test.html">Тест</a> | 
               <a class="btn contact-btn" href="../TRZBD.pdf" style="font-size: 10px; margin-top: 0;">Скачать pdf</a>
           </div>
       </div>
    </div>


<script src="https://kit.fontawesome.com/475833b573.js" crossorigin="anonymous"></script>
<script src="../js/main.js"></script>

<!-- jquery -->
<script src="../js/jquery-1.7.2.min.js" type="text/javascript"></script>
<!-- easing plugin ( optional ) -->
<script src="../js/easing.js" type="text/javascript"></script>
<!-- UItoTop plugin -->
<script src="../js/jquery.ui.totop.js" type="text/javascript"></script>
<!-- Starting the plugin -->
<script type="text/javascript">
$(document).ready(function() {
/*
var defaults = {
containerID: 'toTop', // fading element id
containerHoverID: 'toTopHover', // fading element hover id
scrollSpeed: 1200,
easingType: 'linear'
};
*/
 
$().UItoTop({ easingType: 'easeOutQuart' });
 
});
</script>

</body>
</html>